---
title: ä»¿å¾®ä¿¡å…³é”®å­—è§¦å‘è¡¨æƒ…åŒ…åŠ¨ç”»æ•ˆæœ
date: 2019-05-21 10:50:14
tags: ['css','javascript']
---

â¤521åˆ°äº†,ç å†œç¿»èº«;
æ¨¡ä»¿å¾®ä¿¡èŠå¤©å‘é€å…³é”®å­— `ä¹ˆä¹ˆå“’` è§¦å‘è¡¨æƒ…åŒ…é›¨`ğŸ˜˜`çš„æ•ˆæœ;

<!--more-->

### 520é‡è§ä½ 

![520Demo](https://raw.githubusercontent.com/Wxh16144/love/master/love.gif)

### å¼€å§‹

ä½¿ç”¨äº†[parcel](https://parceljs.org);

å…¶å®ä¸è¦ä¹Ÿå¯ä»¥,å¹¶æ²¡æœ‰ç”¨åˆ°ä»€ä¹ˆ,ä¸»è¦æ˜¯è‡ªå·±æƒ³ä½¿ç”¨`sass`é¢„ç¼–è¯‘è¯­æ³•,åµŒå¥—ä½¿ç”¨;

è¿™æ¬¡åˆ†äº«ä¸»è¦æ˜¯å¦‚ä½•å®ç°è¿™ä¸ªåŠ¨ç”»æ•ˆæœçš„;

+ htmléƒ¨åˆ†

```html
<body>
    <div id="root">
      <div id="phone">
        <div id="header">å®è´â¤</div>
        <div id="main">
          <div id="keyword">
            <p class="myself" style="--name:'æˆ‘'">åœ¨å—?</p>
            <br>
            <p class="myself" style="--name:'æˆ‘'">åœ¨å¹²å˜›?</p>
            <p class="opposite" style="--name:'å®è´'">å¤šå–çƒ«æ°´!</p>
          </div>
          <div class="bg theme"></div>
          <!--è¡¨æƒ…åŒ…åŠ¨ç”»é›¨å®¹å™¨-->
          <div id="animation"></div>
        </div>
        <div id="footer">
          <input type="text" id="message" maxlength="255" />
          <button id="send">å‘é€</button>
        </div>
      </div>
    </div>
  </body>
```

+ è·å–æ¯ä¸ªéƒ¨åˆ†çš„å®¹å™¨

```javascript
  const $ = str => document.querySelector(str);
  const myRandom = (min = 0, max = min + 1) => Math.random() * (max - min + 1) + min;
  const elObj = {
    // ... å…¶ä»–çœç•¥
    root: $('#root'), // æ ¹ç›®å½•
    animation: $('#animation'), // åŠ¨ç”»å®¹å™¨
    message: $('#message'), // è¾“å…¥æ¡†
    send: $('#send') // å‘é€æŒ‰é’®
  }
```
### å®ç°åŠ¨ç”» `createAnimation`æ–¹æ³•

+ åˆ¤æ–­è¡¨æƒ…åŒ…

```javascript
const createAnimation = icon => {
  let logo = icon;
  // å¦‚æœè¡¨æƒ…åŒ…ä¼ å…¥çš„æ˜¯æ•°ç»„,éšæœºå–ä¸€ä¸ª;
  if (Array.isArray(icon)) {
    const index = myRandom(0, icon.length - 1)
    logo = icon[Math.floor(index)];
  }
}
```

+ è·å–å…ƒç´ çš„ä½ç½®

```javascript
  const { width, height, top, bottom } = elObj.main.getBoundingClientRect();
  const count = Math.round(width * height / 5000); // è¡¨æƒ…åŒ…æ•°é‡
  const averageCount = Math.round(width / 65); // æ¯ä¸ªè¡¨æƒ…åŒ…å ä¸€è¡Œçš„65px (è¿™é‡Œè®¡ç®—ä¸€è¡Œæœ‰å‡ ä¸ª)
  const fw = width / averageCount; // èŒƒå›´åƒç´  (å› ä¸ºä¸Šé¢å†™æ­»65px) å¯èƒ½æœ‰å°æ•°;
```

+ å¾ªç¯åˆ›å»ºå…ƒç´ 

```javascript
[...Array(count).keys()].forEach(index => {
    let childEl = document.createElement('i');
    //è®¡ç®—å®šä½leftå·¦è¾¹è·
    const left = (myRandom(1, fw) + fw) * (index % averageCount) + 'px';
    // ...
})
```
+ ç»™å…ƒç´ æ·»åŠ å±æ€§å’ŒåŠ¨ç”»

```javascript
  childEl.classList = 'icon-itme'; // æ·»åŠ class
  childEl.innerText = logo || 'ğŸ˜˜' // æ·»åŠ è¡¨æƒ…åŒ…
  childEl.style.left = left // å·¦è¾¹è·
  childEl.style.position = 'absolute' // æ·»åŠ å®šä½
  childEl.style.fontSize = '32px'; // è®¾ç½®å­—ä½“å¤§å°
  childEl.style.transform = `translate(${left},${-50}px)`; // ä½ç§»
  // ä¸ºæ¯ä¸€ä¸ªåŠ¨ç”»æ·»åŠ è¿‡æ¸¡æ—¶é—´å’Œè¿‡æ¸¡å»¶è¿Ÿ,éšæœºç”Ÿæˆ;
  childEl.style.transition = `transform ${myRandom(3, 6)}s linear ${myRandom(1, 2)}s`;
```

+ æ·»åŠ ä½ç§»åˆ°æŒ‡å®šä½ç½®åŠ¨ç”»

```javascript
  //  è¿™é‡Œä½¿ç”¨setTimeoutæ˜¯å› ä¸ºjsçš„ event loop;
  setTimeout(() => {
   // ç§»åŠ¨åˆ°åº•éƒ¨ å¹¶éšæœºä¿®æ”¹å…ƒçš„Xè½´å¤§å°,éšæœºå¯¹å…ƒç´ æ—‹è½¬
   childEl.style.transform = `translate(${myRandom(1, fw)}px,${height + 50}px) rotate(${myRandom(-90, 90)}deg)`
  }, 0)
```

è¿™é‡Œä¸ç”¨`setTimeout` æµè§ˆå™¨ä¼šé»˜è®¤ä½¿ç”¨ç¬¬äºŒä¸ªåŠ¨ç”»,ä½¿ç”¨å°±ä¸ä¼šæœ‰åŠ¨ç”»æ•ˆæœå®ç°;
å¤§å®¶å¯ä»¥å…ˆå»äº†è§£æµè§ˆå™¨`event-loop`;
è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« å¯ä»¥å‚è€ƒä¸€ä¸‹[ã€ç¬¬1405æœŸã€‘æµè§ˆå™¨çš„ Event Loop](https://mp.weixin.qq.com/s/r9hJmsK9oprn5f1CbhAHNQ)

+ åŠ¨ç”»æ‰§è¡Œå®Œæ¯•ååˆ é™¤å…ƒç´ 

```javascript
  // è¿‡æ¸¡ç»“æŸåæ‰§è¡Œ
  childEl.addEventListener('transitionend', ({ target }) => {
    target.parentNode.removeChild(target); // åˆ é™¤æ‰§è¡Œå®ŒåŠ¨ç”»çš„å…ƒç´ 
  }) 
  elObj.animation.appendChild(childEl); // æ·»åŠ å…ƒç´ åˆ°åŠ¨ç”»å®¹å™¨ä¸­
```

åˆ°è¿™é‡Œ,æˆ‘çš„æ•´ä¸ªåˆ›å»ºè¡¨æƒ…åŒ…é›¨çš„æ•ˆæœå·²è¿‘å®Œæˆäº†;
è‡³äºå¦‚ä½•é€šè¿‡å‘é€æ¶ˆæ¯åŒ¹é…å…³é”®å­—æˆ‘ä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼;

### è§¦å‘å…³é”®å­—
+ æ–°å»ºä¸€ä¸ªkeyword.jsä¸“é—¨ç»´æŠ¤å…³é”®å­—

```javascript
export default {
  'ä¹ˆä¹ˆå“’': 'ğŸ˜˜',
  'çŒª': ['ğŸ–', 'ğŸ½', 'ğŸ·', 'ğŸ—'],
  'çˆ±|love': ['â¤', 'ğŸ’•'],
  'å¤§ä¾¿|ç²‘ç²‘': 'ğŸ’©',
}
```

+ å®ç°å‘é€æ¶ˆæ¯æ–¹æ³•

```javascript
//HTMLè½¬ä¹‰
const HTMLEncode = html => {
  const el = document.createElement("div");
  el.textContent ? el.textContent = html : el.innerText = html
  return el.innerHTML;
}
// è¿½åŠ èŠå¤©è®°å½•
const pushMessage = (str, name, ismyself) => {
  if (!str) return false;
  var html = `
    <p class="${ismyself ? 'myself' : 'opposite'}"
       style="--name:'${name}'">${HTMLEncode(str)}
    </p>
  `
  elObj.keyword.innerHTML += html;  // æ·»åŠ èŠå¤©å†…å®¹
  elObj.main.scrollTop = elObj.keyword.scrollHeight
  // åˆ¤æ–­èŠå¤©å†…å®¹æœ‰æ²¡æœ‰å…³é”®å­—
  const find = Object.keys(keyword).find(key => new RegExp(key, 'ig').test(str))
  const icon = keyword[find]; // æ‰¾åˆ°åŒ¹é…çš„è¡¨æƒ…åŒ…
  icon && createAnimation(icon) // åˆ›å»ºåŠ¨ç”»
}
```

+ æ·»åŠ å‘é€æŒ‰é’®ç‚¹å‡»äº‹ä»¶

```javascript
elObj.send.addEventListener('click', () => {
  const inputval = elObj.message.value; // è¾“å…¥æ¡†å†…å®¹
  inputval && pushMessage(inputval, 'æˆ‘', true); // å‘é€æ¶ˆæ¯
  elObj.message.value = ''; //æ¸…ç©ºè¾“å…¥
})
```

åˆ°è¿™é‡Œæ•´ä¸ªé¡¹ç›®çš„ä»£ç å°±å®Œæˆäº†;æœ‰ä¸€äº›æ ·å¼æˆ‘å·æ‡’äº†è¿˜æœ‰äº›é—®é¢˜;
ä½†ä»Šå¤©æˆ‘å’Œå¤§å®¶åˆ†äº«çš„æ˜¯åŠ¨ç”»æ•ˆæœçš„å®ç°;
æ˜å¹´520åœ¨ä¿®å¤;
ä»£ç æˆ‘æ”¾åˆ°äº†GitHubä¸Šäº†[é¡¹ç›®ä»£ç ](https://github.com/Wxh16144/love);

æˆ‘å»ºç«‹äº†ç¬¬ä¸€ä¸ª`issues` æ¬¢è¿å¤§å®¶å¸®åŠ©æˆ‘;
å¾ˆå¤šå…³é”®å­—åŒ¹é…è¡¨æƒ…åŒ…æ²¡æœ‰å®Œæˆ,æ¬¢è¿å¤§å®¶`Fork`å’Œ`pull requests`å®Œå–„æˆ‘ä»¬çš„é¡¹ç›®;
åœ¨[è¿™é‡Œ](https://github.com/Wxh16144/love/blob/master/keyword.js)ä½ å¯ä»¥æ·»åŠ ä½ çš„ä»£ç ;

### ğŸŒ°example
> æˆ‘éœ€è¦æ·»åŠ ä¸€ä¸ª `ç”·äºº` å’Œ `man`
> `key` æ˜¯å…³é”®å­—,å¤šä¸ªå¯ä»¥ç”¨ `|` åŒºåˆ†
> `value` æ˜¯åŒ¹é…çš„è¡¨æƒ…åŒ…,å¤šä¸ªå¯ä»¥ç”¨ `Array` ç±»å‹,å¦‚æœå°±ä¸€ä¸ªå¯ä»¥ç›´æ¥æ·»åŠ Emoji

```javascript
export default {
  // old code
  'ç”·äºº|man': 'ğŸ‘¨',
  'å¥³äºº|girl': ['ğŸ‘§', 'ğŸ‘§ğŸ»']
}
```
